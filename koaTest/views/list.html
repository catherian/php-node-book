{% extends "layout.html" %}
{% block title %}index {{title}}{% endblock %}


{%  block content %}
<div class="container">
        <ul class="breadcrumb"><li><a href="/index.php">Home</a></li>
<li class="active">å›¾ä¹¦åˆ—è¡¨</li>
</ul>                
<div class="row">
    <div class="container">
        <div class="mb-20">
            <a class="btn btn-primary" href="/edit">Create a new book ğŸ“–</a>
        </div>
        <table id="JS-books-table" class="table table-bordered">
            <colgroup>
            <col width="10%">
            <col width="30%">
            <col width="20%">
            <col width="20%">


            </colgroup>
            <thead>
                <tr>
                <th>å›¾ä¹¦ç¼–å·</th>
                <th>ä¹¦å</th>
                <th>æè¿°</th>
                <th>åˆ›å»ºæ—¶é—´</th>
                <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                
            </tbody>
        </table>
        <div class="mt--15">
        </div>
    </div>
</div>
<script>
    $(function() {
        $.getJSON('/apiList', function(books) {
            $('#JS-books-table tbody').html(
                books.map((book) => {
                    return (
                        "<tr>"+
                        "<td>" + book.id + "</td>" +
                        "<td>" + book.title + "</td>" +
                        "<td>" + book.describe + "</td>" +
                        "<td>" + book.create_time_at + "</td>" +
                        "<td>" +
                            "<a class='btn btn-default btn-sm' href='/edit?id=" + book.id + "'>ç¼–è¾‘</a>" +
                            "<div data-id='" + book.id + "' class='btn btn-danger btn-sm ml-10 JS-delete-book'>åˆ é™¤</div>" +
                        "</td>" +
                        "</tr>"
                    )
                }).join('')
            );
        });
        $('#JS-books-table').delegate('.JS-delete-book','click',function(){
            var id = $(this).attr('data-id');
            // console.log(id);
                var trNode = $(this).closest('tr');
                $.get('/deleteId', { id: id }, function(data) {
                    console.log(data);
                    if (data.success) {
                        trNode.remove();
                        layer.msg('åˆ é™¤æˆåŠŸ');                        
                    }
                });
        });
        
    });
</script>
</div>
{% endblock %}